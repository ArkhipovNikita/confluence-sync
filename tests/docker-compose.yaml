services:
  postgresql-src:
    image: postgres:16
    environment:
      POSTGRES_DB: "confluence"
      POSTGRES_USER: "confluence"
      POSTGRES_PASSWORD: "confluence"
    volumes:
      - pgdata-src:/var/lib/postgresql/data

  confluence-src:
    image: atlassian/confluence:9.2.2
    environment:
      ATL_JDBC_URL: "jdbc:postgresql://postgresql-src:5432/confluence"
      ATL_JDBC_USER: "confluence"
      ATL_JDBC_PASSWORD: "confluence"
      ATL_DB_TYPE: "postgresql"
    ports:
      - "8090:8090"
    volumes:
      - confluence-src:/var/atlassian/application-data/confluence

  postgresql-dst:
    image: postgres:16
    environment:
      POSTGRES_DB: "confluence"
      POSTGRES_USER: "confluence"
      POSTGRES_PASSWORD: "confluence"
    volumes:
      - pgdata-dst:/var/lib/postgresql/data

  confluence-dst:
    image: atlassian/confluence:9.2.2
    environment:
      ATL_JDBC_URL: "jdbc:postgresql://postgresql-dst:5432/confluence"
      ATL_JDBC_USER: "confluence"
      ATL_JDBC_PASSWORD: "confluence"
      ATL_DB_TYPE: "postgresql"
    ports:
      - "9090:8090"
    volumes:
      - confluence-dst:/var/atlassian/application-data/confluence

volumes:
  pgdata-src:
  confluence-src:
  pgdata-dst:
  confluence-dst:
